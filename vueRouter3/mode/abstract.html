<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Abstract模式 | 前端源码解读</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="前端源码解读文档;使用过程中如碰到问题，请到Github进行提问。 https://github.com/CrayonPig/originCodeCommit">
    
    <link rel="preload" href="/assets/css/0.styles.96eb8417.css" as="style"><link rel="preload" href="/assets/js/app.bd142e4f.js" as="script"><link rel="preload" href="/assets/js/2.ff6775b1.js" as="script"><link rel="preload" href="/assets/js/1.1085e0bf.js" as="script"><link rel="preload" href="/assets/js/99.6b42021b.js" as="script"><link rel="prefetch" href="/assets/js/10.798a13dc.js"><link rel="prefetch" href="/assets/js/100.7993b243.js"><link rel="prefetch" href="/assets/js/101.9807c2de.js"><link rel="prefetch" href="/assets/js/102.cf5b6478.js"><link rel="prefetch" href="/assets/js/103.f5122834.js"><link rel="prefetch" href="/assets/js/104.12cdd711.js"><link rel="prefetch" href="/assets/js/105.b8e11a5c.js"><link rel="prefetch" href="/assets/js/106.747c0a4c.js"><link rel="prefetch" href="/assets/js/107.d9541280.js"><link rel="prefetch" href="/assets/js/108.b357b164.js"><link rel="prefetch" href="/assets/js/109.142b2cc2.js"><link rel="prefetch" href="/assets/js/11.9075ffd6.js"><link rel="prefetch" href="/assets/js/110.20df3303.js"><link rel="prefetch" href="/assets/js/111.42497fb2.js"><link rel="prefetch" href="/assets/js/112.16ed3f20.js"><link rel="prefetch" href="/assets/js/113.24dee4c3.js"><link rel="prefetch" href="/assets/js/114.bb0ef6ad.js"><link rel="prefetch" href="/assets/js/115.7255742f.js"><link rel="prefetch" href="/assets/js/116.45860f7b.js"><link rel="prefetch" href="/assets/js/117.0d1942af.js"><link rel="prefetch" href="/assets/js/118.fd2de7f9.js"><link rel="prefetch" href="/assets/js/119.c65feb93.js"><link rel="prefetch" href="/assets/js/12.8ad83654.js"><link rel="prefetch" href="/assets/js/120.1a2f766c.js"><link rel="prefetch" href="/assets/js/13.38f8b466.js"><link rel="prefetch" href="/assets/js/14.4feb982d.js"><link rel="prefetch" href="/assets/js/15.7ba29c3c.js"><link rel="prefetch" href="/assets/js/16.01affe3e.js"><link rel="prefetch" href="/assets/js/17.7cf9cc51.js"><link rel="prefetch" href="/assets/js/18.ae4486b4.js"><link rel="prefetch" href="/assets/js/19.8e825451.js"><link rel="prefetch" href="/assets/js/20.edd797a9.js"><link rel="prefetch" href="/assets/js/21.c65e48bf.js"><link rel="prefetch" href="/assets/js/22.48066223.js"><link rel="prefetch" href="/assets/js/23.7edb15eb.js"><link rel="prefetch" href="/assets/js/24.557855a8.js"><link rel="prefetch" href="/assets/js/25.5a53bd0a.js"><link rel="prefetch" href="/assets/js/26.b3fdf584.js"><link rel="prefetch" href="/assets/js/27.4aa07a45.js"><link rel="prefetch" href="/assets/js/28.9fc050f2.js"><link rel="prefetch" href="/assets/js/29.ea7d19b3.js"><link rel="prefetch" href="/assets/js/3.c46963c6.js"><link rel="prefetch" href="/assets/js/30.596ae1cf.js"><link rel="prefetch" href="/assets/js/31.c04856b0.js"><link rel="prefetch" href="/assets/js/32.232fb5d8.js"><link rel="prefetch" href="/assets/js/33.0cccd269.js"><link rel="prefetch" href="/assets/js/34.a0a28ba0.js"><link rel="prefetch" href="/assets/js/35.1bed48e7.js"><link rel="prefetch" href="/assets/js/36.657e9ed9.js"><link rel="prefetch" href="/assets/js/37.d7396fd8.js"><link rel="prefetch" href="/assets/js/38.546e30bd.js"><link rel="prefetch" href="/assets/js/39.5161de92.js"><link rel="prefetch" href="/assets/js/4.a7f1d7d0.js"><link rel="prefetch" href="/assets/js/40.8746ffe1.js"><link rel="prefetch" href="/assets/js/41.727bd2e4.js"><link rel="prefetch" href="/assets/js/42.a6842aa4.js"><link rel="prefetch" href="/assets/js/43.63922ae0.js"><link rel="prefetch" href="/assets/js/44.4dbf33d8.js"><link rel="prefetch" href="/assets/js/45.e41db646.js"><link rel="prefetch" href="/assets/js/46.aea9c258.js"><link rel="prefetch" href="/assets/js/47.5fb34d10.js"><link rel="prefetch" href="/assets/js/48.ee4d87b6.js"><link rel="prefetch" href="/assets/js/49.eb75d2a2.js"><link rel="prefetch" href="/assets/js/5.ded03f0e.js"><link rel="prefetch" href="/assets/js/50.fa7c9915.js"><link rel="prefetch" href="/assets/js/51.faeaa9ef.js"><link rel="prefetch" href="/assets/js/52.ca0d908d.js"><link rel="prefetch" href="/assets/js/53.40861c35.js"><link rel="prefetch" href="/assets/js/54.e3070773.js"><link rel="prefetch" href="/assets/js/55.6e118ff2.js"><link rel="prefetch" href="/assets/js/56.228e2516.js"><link rel="prefetch" href="/assets/js/57.62afdd52.js"><link rel="prefetch" href="/assets/js/58.2c05b707.js"><link rel="prefetch" href="/assets/js/59.62b309b1.js"><link rel="prefetch" href="/assets/js/6.3a95fe11.js"><link rel="prefetch" href="/assets/js/60.56920d47.js"><link rel="prefetch" href="/assets/js/61.f86b7f1b.js"><link rel="prefetch" href="/assets/js/62.dded81a0.js"><link rel="prefetch" href="/assets/js/63.cc38fdcb.js"><link rel="prefetch" href="/assets/js/64.f5b8c786.js"><link rel="prefetch" href="/assets/js/65.1e43ef82.js"><link rel="prefetch" href="/assets/js/66.fb5dd36f.js"><link rel="prefetch" href="/assets/js/67.60884eba.js"><link rel="prefetch" href="/assets/js/68.bc2da17f.js"><link rel="prefetch" href="/assets/js/69.1d9805e3.js"><link rel="prefetch" href="/assets/js/7.76d5901e.js"><link rel="prefetch" href="/assets/js/70.f828fed2.js"><link rel="prefetch" href="/assets/js/71.b09738b4.js"><link rel="prefetch" href="/assets/js/72.2478946d.js"><link rel="prefetch" href="/assets/js/73.504a9b13.js"><link rel="prefetch" href="/assets/js/74.1ae315f2.js"><link rel="prefetch" href="/assets/js/75.d3d32fc7.js"><link rel="prefetch" href="/assets/js/76.0898b539.js"><link rel="prefetch" href="/assets/js/77.c0473655.js"><link rel="prefetch" href="/assets/js/78.6817762a.js"><link rel="prefetch" href="/assets/js/79.80873e8a.js"><link rel="prefetch" href="/assets/js/80.1bfba839.js"><link rel="prefetch" href="/assets/js/81.95085c58.js"><link rel="prefetch" href="/assets/js/82.718d994d.js"><link rel="prefetch" href="/assets/js/83.38cbea8f.js"><link rel="prefetch" href="/assets/js/84.4aed0151.js"><link rel="prefetch" href="/assets/js/85.b4b58ffb.js"><link rel="prefetch" href="/assets/js/86.6ce29b31.js"><link rel="prefetch" href="/assets/js/87.ec892f26.js"><link rel="prefetch" href="/assets/js/88.c787c583.js"><link rel="prefetch" href="/assets/js/89.204d6807.js"><link rel="prefetch" href="/assets/js/90.10eca24a.js"><link rel="prefetch" href="/assets/js/91.cab4bcd9.js"><link rel="prefetch" href="/assets/js/92.3b7e0952.js"><link rel="prefetch" href="/assets/js/93.238eebb9.js"><link rel="prefetch" href="/assets/js/94.d8c325f8.js"><link rel="prefetch" href="/assets/js/95.3b3dd734.js"><link rel="prefetch" href="/assets/js/96.b8be881c.js"><link rel="prefetch" href="/assets/js/97.f8f5f53a.js"><link rel="prefetch" href="/assets/js/98.343b4e81.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.19a8d69a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.96eb8417.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端源码解读</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue2相关" class="dropdown-title"><span class="title">Vue2相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue2相关" class="mobile-dropdown-title"><span class="title">Vue2相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueRouter3/" class="nav-link router-link-active">
  Vue Route V3
</a></li><li class="dropdown-item"><!----> <a href="/vuex3/" class="nav-link">
  VueX V3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3相关" class="dropdown-title"><span class="title">Vue3相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue3相关" class="mobile-dropdown-title"><span class="title">Vue3相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CrayonPig/originCodeCommit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue2相关" class="dropdown-title"><span class="title">Vue2相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue2相关" class="mobile-dropdown-title"><span class="title">Vue2相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueRouter3/" class="nav-link router-link-active">
  Vue Route V3
</a></li><li class="dropdown-item"><!----> <a href="/vuex3/" class="nav-link">
  VueX V3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3相关" class="dropdown-title"><span class="title">Vue3相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue3相关" class="mobile-dropdown-title"><span class="title">Vue3相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CrayonPig/originCodeCommit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vueRouter3/" aria-current="page" class="sidebar-link">Vue Router V3 源码解析</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>准备工作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/prepare/directory.html" class="sidebar-link">目录结构</a></li><li><a href="/vueRouter3/prepare/build.html" class="sidebar-link">源码构建</a></li><li><a href="/vueRouter3/prepare/entry.html" class="sidebar-link">源码入口</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>初始化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/init/" class="sidebar-link">前言</a></li><li><a href="/vueRouter3/init/install.html" class="sidebar-link">注册插件</a></li><li><a href="/vueRouter3/init/instantiate.html" class="sidebar-link">实例化</a></li><li><a href="/vueRouter3/init/mount.html" class="sidebar-link">挂载</a></li><li><a href="/vueRouter3/init/addComponent.html" class="sidebar-link">使用组件</a></li><li><a href="/vueRouter3/init/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>路由匹配</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/matcher/" class="sidebar-link">路由介绍</a></li><li><a href="/vueRouter3/matcher/matcher.html" class="sidebar-link">匹配器</a></li><li><a href="/vueRouter3/matcher/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>路由模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/mode/" aria-current="page" class="sidebar-link">简介</a></li><li><a href="/vueRouter3/mode/history.html" class="sidebar-link">History模式</a></li><li><a href="/vueRouter3/mode/hash.html" class="sidebar-link">Hash模式</a></li><li><a href="/vueRouter3/mode/abstract.html" aria-current="page" class="active sidebar-link">Abstract模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#实例化" class="sidebar-link">实例化</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#常见方法" class="sidebar-link">常见方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#push" class="sidebar-link">push</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#replace" class="sidebar-link">replace</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#go" class="sidebar-link">go</a></li></ul></li><li class="sidebar-sub-header"><a href="/vueRouter3/mode/abstract.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/advanced/navigation-guards.html" class="sidebar-link">导航守卫</a></li><li><a href="/vueRouter3/advanced/route-view.html" class="sidebar-link">&lt;router-view&gt;</a></li><li><a href="/vueRouter3/advanced/route-link.html" class="sidebar-link">&lt;router-link&gt;</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="abstract模式"><a href="#abstract模式" class="header-anchor">#</a> Abstract模式</h1> <h2 id="实例化"><a href="#实例化" class="header-anchor">#</a> 实例化</h2> <p>跟其他模式一样，都是在<code>new VueRouter</code>的时候，通过判断传入的<code>mode</code>来判断最后初始化路由模式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbstractHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647252157-3805">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="this.history = new AbstractHistory(this, options.base)
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647252157-3805" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上述代码可以看出，初始化的时候，会创建一个<code>AbstractHistory</code>实例，将<code>this</code>和设定的基准路径<code>base</code>，我们找到<code>AbstractHistory</code>的定义</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AbstractHistory</span> <span class="token keyword">extends</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> number
  <span class="token literal-property property">stack</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Route<span class="token operator">&gt;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">router</span><span class="token operator">:</span> Router<span class="token punctuation">,</span> <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token operator">?</span>string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>router<span class="token punctuation">,</span> base<span class="token punctuation">)</span>
    <span class="token comment">// 路由的历史记录</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// 当前路由的索引</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647252157-31317">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export class AbstractHistory extends History {
  index: number
  stack: Array&lt;Route&gt;

  constructor (router: Router, base: ?string) {
    super(router, base)
    // 路由的历史记录
    this.stack = []
    // 当前路由的索引
    this.index = -1
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647252157-31317" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>跟<code>HTML5History</code>一样，都是继承自<code>History</code>，并且在初始化的时候进行的调用，这里就不赘述<code>History</code>的实现了。</p> <p>接下来创建了两个变量，用于记录历史记录和当前的路由索引</p> <h2 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h2> <p>在<code>abstract</code>模式下，初始化的时候没有做额外操作，只是加个了路由变化的回调。</p> <h2 id="常见方法"><a href="#常见方法" class="header-anchor">#</a> 常见方法</h2> <p>分析完实例化和初始化后，我们分析下我们工作中一些常见的方法</p> <h3 id="push"><a href="#push" class="header-anchor">#</a> push</h3> <p><code>push</code>在<code>VueRouter</code>类中的的实现跟其他模式是一致的，这里只分析不同的<code>this.history.push</code>的实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">push</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>
    location<span class="token punctuation">,</span>
    <span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 舍去当前索引之后的历史记录，将新路由添加到栈顶</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
      <span class="token comment">// 更新索引</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token operator">++</span>
      onComplete <span class="token operator">&amp;&amp;</span> <span class="token function">onComplete</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onAbort
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647252158-49626">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="push (location: RawLocation, onComplete?: Function, onAbort?: Function) {
  this.transitionTo(
    location,
    route =&gt; {
      // 舍去当前索引之后的历史记录，将新路由添加到栈顶
      this.stack = this.stack.slice(0, this.index + 1).concat(route)
      // 更新索引
      this.index++
      onComplete &amp;&amp; onComplete(route)
    },
    onAbort
  )
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647252158-49626" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以看到，执行<code>push</code>操作的时候，就是舍去当前索引之后的历史记录，将新路由添加到栈顶</p> <p>有的同学可能有疑问，为什么不直接使用<code>this.stack.push(route)</code>方法添加呢？</p> <p>这是因为，还存在<code>go</code>方法，当前索引可能不是栈的最顶端，当我们执行<code>push</code>操作后，所有在当前历史记录后面的记录都应该被忽略。</p> <p>如果我们直接使用<code>this.stack.push(route)</code>，那么会直接把新的路由添加到历史记录栈的尾部，而忽略了可能存在的需要删除的历史记录，这样就可能导致历史记录错乱。因此，这里使用<code>this.stack = this.stack.slice(0, this.index + 1).concat(route)</code>而非<code>this.stack.push(route)</code>。</p> <h3 id="replace"><a href="#replace" class="header-anchor">#</a> replace</h3> <p>同理，<code>replace</code>方法的不同点也是在于<code>this.history.replace</code>的实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">replace</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> onComplete<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> onAbort<span class="token operator">?</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>
    location<span class="token punctuation">,</span>
    <span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 用新的记录替换当前记录，并舍去后续历史记录</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
      onComplete <span class="token operator">&amp;&amp;</span> <span class="token function">onComplete</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onAbort
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647252158-77442">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="replace (location: RawLocation, onComplete?: Function, onAbort?: Function) {
  this.transitionTo(
    location,
    route =&gt; {
      // 用新的记录替换当前记录，并舍去后续历史记录
      this.stack = this.stack.slice(0, this.index).concat(route)
      onComplete &amp;&amp; onComplete(route)
    },
    onAbort
  )
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647252158-77442" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>replace</code>方法就很清晰了，直接用新的记录替换当前记录，并舍去后续历史记录</p> <h3 id="go"><a href="#go" class="header-anchor">#</a> go</h3> <p><code>push</code>在<code>VueRouter</code>类中的的实现跟其他模式是一致的，这里只分析不同的<code>this.history.go</code>的实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">go</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">n</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> targetIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">+</span> n
  <span class="token comment">// 目标索引超出范围，不予处理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetIndex <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> targetIndex <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 获取指向路由</span>
  <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span>targetIndex<span class="token punctuation">]</span>
  <span class="token comment">// 跳转</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">confirmTransition</span><span class="token punctuation">(</span>
    route<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
      <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> targetIndex
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
      <span class="token comment">// 触发跳转成功回调</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span>afterHooks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">hook</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        hook <span class="token operator">&amp;&amp;</span> <span class="token function">hook</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> prev<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNavigationFailure</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> NavigationFailureType<span class="token punctuation">.</span>duplicated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> targetIndex
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647252158-44437">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="go (n: number) {
  const targetIndex = this.index + n
  // 目标索引超出范围，不予处理
  if (targetIndex &lt; 0 || targetIndex &gt;= this.stack.length) {
    return
  }
  // 获取指向路由
  const route = this.stack[targetIndex]
  // 跳转
  this.confirmTransition(
    route,
    () =&gt; {
      const prev = this.current
      this.index = targetIndex
      this.updateRoute(route)
      // 触发跳转成功回调
      this.router.afterHooks.forEach(hook =&gt; {
        hook &amp;&amp; hook(route, prev)
      })
    },
    err =&gt; {
      if (isNavigationFailure(err, NavigationFailureType.duplicated)) {
        this.index = targetIndex
      }
    }
  )
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647252158-44437" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>go</code>的方法相比于<code>push</code>、<code>replace</code>方法，找到对应路由后，没有使用<code>transitionTo</code>包裹，直接使用<code>confirmTransition</code>跳转，这是因为<code>go</code>是对历史记录进行操作，已经有对应的<code>route</code>对象，不需要重新匹配，只需要按照对应的<code>route</code>对象进行切换组件即可</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p><code>abstract</code>模式被设计为在没有浏览器API支持的环境下使用（例如服务器端渲染、React Native等）。在这种模式下，路由的改变并不会像在浏览器环境中那样体现在URL的变化中。所以在该模式的源码中，没有这部分的操作。</p> <p><code>abstract</code>模式通过对路由历史记录栈和索引的管理，实现路由的切换</p> <ul><li><code>push</code>方法，直接删除索引后续的历史记录，将新的路由添加到历史记录栈的顶端</li> <li><code>replace</code>方法，用新的记录替换当前记录，并舍去后续历史记录</li> <li><code>go</code>方法，找到历史记录中的<code>route</code>对象后，执行组件切换</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vueRouter3/mode/hash.html" class="prev">
        Hash模式
      </a></span> <span class="next"><a href="/vueRouter3/advanced/navigation-guards.html">
        导航守卫
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bd142e4f.js" defer></script><script src="/assets/js/2.ff6775b1.js" defer></script><script src="/assets/js/1.1085e0bf.js" defer></script><script src="/assets/js/99.6b42021b.js" defer></script>
  </body>
</html>
