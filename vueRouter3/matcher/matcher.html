<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>匹配器 | 前端源码解读</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="前端源码解读文档;使用过程中如碰到问题，请到Github进行提问。 https://github.com/CrayonPig/originCodeCommit">
    
    <link rel="preload" href="/assets/css/0.styles.96eb8417.css" as="style"><link rel="preload" href="/assets/js/app.41678a85.js" as="script"><link rel="preload" href="/assets/js/2.88c18509.js" as="script"><link rel="preload" href="/assets/js/1.d4c099ff.js" as="script"><link rel="preload" href="/assets/js/90.dc287682.js" as="script"><link rel="prefetch" href="/assets/js/10.b14aa6d6.js"><link rel="prefetch" href="/assets/js/100.b81a9f68.js"><link rel="prefetch" href="/assets/js/101.e0a82537.js"><link rel="prefetch" href="/assets/js/102.cef4c310.js"><link rel="prefetch" href="/assets/js/103.84d389c8.js"><link rel="prefetch" href="/assets/js/104.3dadedf2.js"><link rel="prefetch" href="/assets/js/105.40b92217.js"><link rel="prefetch" href="/assets/js/106.ca90c30d.js"><link rel="prefetch" href="/assets/js/107.d5698a51.js"><link rel="prefetch" href="/assets/js/108.e4c49f09.js"><link rel="prefetch" href="/assets/js/109.53618483.js"><link rel="prefetch" href="/assets/js/11.9fe1d85e.js"><link rel="prefetch" href="/assets/js/110.c01b0b2b.js"><link rel="prefetch" href="/assets/js/111.893621b2.js"><link rel="prefetch" href="/assets/js/112.5000d350.js"><link rel="prefetch" href="/assets/js/113.a13fbd91.js"><link rel="prefetch" href="/assets/js/12.86508e15.js"><link rel="prefetch" href="/assets/js/13.e426305d.js"><link rel="prefetch" href="/assets/js/14.4a65991d.js"><link rel="prefetch" href="/assets/js/15.42e542bb.js"><link rel="prefetch" href="/assets/js/16.42d8df26.js"><link rel="prefetch" href="/assets/js/17.11d996a2.js"><link rel="prefetch" href="/assets/js/18.6f8f0eec.js"><link rel="prefetch" href="/assets/js/19.67e71589.js"><link rel="prefetch" href="/assets/js/20.9f10fe7c.js"><link rel="prefetch" href="/assets/js/21.fb9b4040.js"><link rel="prefetch" href="/assets/js/22.ba4edf56.js"><link rel="prefetch" href="/assets/js/23.f26baabe.js"><link rel="prefetch" href="/assets/js/24.daa8f3cf.js"><link rel="prefetch" href="/assets/js/25.c7ce090d.js"><link rel="prefetch" href="/assets/js/26.e145e79f.js"><link rel="prefetch" href="/assets/js/27.ce419d8c.js"><link rel="prefetch" href="/assets/js/28.e6a20cf5.js"><link rel="prefetch" href="/assets/js/29.efee71ea.js"><link rel="prefetch" href="/assets/js/3.47d5fbb2.js"><link rel="prefetch" href="/assets/js/30.92b0a4a3.js"><link rel="prefetch" href="/assets/js/31.7615f778.js"><link rel="prefetch" href="/assets/js/32.672db2e6.js"><link rel="prefetch" href="/assets/js/33.614e8e6a.js"><link rel="prefetch" href="/assets/js/34.4dee2ea6.js"><link rel="prefetch" href="/assets/js/35.a1c6adf9.js"><link rel="prefetch" href="/assets/js/36.56c62be9.js"><link rel="prefetch" href="/assets/js/37.6b8e830c.js"><link rel="prefetch" href="/assets/js/38.5b49d115.js"><link rel="prefetch" href="/assets/js/39.b768530c.js"><link rel="prefetch" href="/assets/js/4.37747ac1.js"><link rel="prefetch" href="/assets/js/40.e2d284e0.js"><link rel="prefetch" href="/assets/js/41.a629b97c.js"><link rel="prefetch" href="/assets/js/42.5d162ccb.js"><link rel="prefetch" href="/assets/js/43.7373897c.js"><link rel="prefetch" href="/assets/js/44.85eadc66.js"><link rel="prefetch" href="/assets/js/45.daaf6074.js"><link rel="prefetch" href="/assets/js/46.e0f325cd.js"><link rel="prefetch" href="/assets/js/47.938152f8.js"><link rel="prefetch" href="/assets/js/48.601fc03c.js"><link rel="prefetch" href="/assets/js/49.c2b5fea3.js"><link rel="prefetch" href="/assets/js/5.094ae013.js"><link rel="prefetch" href="/assets/js/50.bb667ca7.js"><link rel="prefetch" href="/assets/js/51.b2296cc6.js"><link rel="prefetch" href="/assets/js/52.0f748ccc.js"><link rel="prefetch" href="/assets/js/53.846c8310.js"><link rel="prefetch" href="/assets/js/54.d9b6263b.js"><link rel="prefetch" href="/assets/js/55.1257a43e.js"><link rel="prefetch" href="/assets/js/56.375f57cf.js"><link rel="prefetch" href="/assets/js/57.8c387b88.js"><link rel="prefetch" href="/assets/js/58.2d37d70d.js"><link rel="prefetch" href="/assets/js/59.31c101df.js"><link rel="prefetch" href="/assets/js/6.77b934eb.js"><link rel="prefetch" href="/assets/js/60.a38f6c5f.js"><link rel="prefetch" href="/assets/js/61.4330e438.js"><link rel="prefetch" href="/assets/js/62.7c4c53fa.js"><link rel="prefetch" href="/assets/js/63.edaec9f8.js"><link rel="prefetch" href="/assets/js/64.6f9fd039.js"><link rel="prefetch" href="/assets/js/65.9c7016b7.js"><link rel="prefetch" href="/assets/js/66.f45c3249.js"><link rel="prefetch" href="/assets/js/67.a61d181d.js"><link rel="prefetch" href="/assets/js/68.1292c76b.js"><link rel="prefetch" href="/assets/js/69.e9790049.js"><link rel="prefetch" href="/assets/js/7.b4d7955c.js"><link rel="prefetch" href="/assets/js/70.c846a21c.js"><link rel="prefetch" href="/assets/js/71.4848594a.js"><link rel="prefetch" href="/assets/js/72.e5f90173.js"><link rel="prefetch" href="/assets/js/73.9701ccd6.js"><link rel="prefetch" href="/assets/js/74.b1e2993b.js"><link rel="prefetch" href="/assets/js/75.d7aae4f2.js"><link rel="prefetch" href="/assets/js/76.d2703b1c.js"><link rel="prefetch" href="/assets/js/77.bec716b9.js"><link rel="prefetch" href="/assets/js/78.3dd535f8.js"><link rel="prefetch" href="/assets/js/79.ed38f618.js"><link rel="prefetch" href="/assets/js/80.ebc1c904.js"><link rel="prefetch" href="/assets/js/81.97b2a272.js"><link rel="prefetch" href="/assets/js/82.4157dd1d.js"><link rel="prefetch" href="/assets/js/83.fe661b36.js"><link rel="prefetch" href="/assets/js/84.1b28bad2.js"><link rel="prefetch" href="/assets/js/85.c02a979f.js"><link rel="prefetch" href="/assets/js/86.16501c7c.js"><link rel="prefetch" href="/assets/js/87.90c25569.js"><link rel="prefetch" href="/assets/js/88.9dfb8b4b.js"><link rel="prefetch" href="/assets/js/89.7f66f899.js"><link rel="prefetch" href="/assets/js/91.dbba1922.js"><link rel="prefetch" href="/assets/js/92.9dafeafc.js"><link rel="prefetch" href="/assets/js/93.d17f55ad.js"><link rel="prefetch" href="/assets/js/94.b8c45319.js"><link rel="prefetch" href="/assets/js/95.dddcd8b1.js"><link rel="prefetch" href="/assets/js/96.2b6ff1b0.js"><link rel="prefetch" href="/assets/js/97.62fd07db.js"><link rel="prefetch" href="/assets/js/98.dd225bf0.js"><link rel="prefetch" href="/assets/js/99.64abcc48.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.68b347c4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.96eb8417.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端源码解读</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue2相关" class="dropdown-title"><span class="title">Vue2相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue2相关" class="mobile-dropdown-title"><span class="title">Vue2相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueRouter3/" class="nav-link router-link-active">
  Vue Route V3
</a></li><li class="dropdown-item"><!----> <a href="/vuex3/" class="nav-link">
  VueX V3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CrayonPig/originCodeCommit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue2相关" class="dropdown-title"><span class="title">Vue2相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue2相关" class="mobile-dropdown-title"><span class="title">Vue2相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueRouter3/" class="nav-link router-link-active">
  Vue Route V3
</a></li><li class="dropdown-item"><!----> <a href="/vuex3/" class="nav-link">
  VueX V3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CrayonPig/originCodeCommit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vueRouter3/" aria-current="page" class="sidebar-link">Vue Router V3 源码解析</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>准备工作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/prepare/directory.html" class="sidebar-link">目录结构</a></li><li><a href="/vueRouter3/prepare/build.html" class="sidebar-link">源码构建</a></li><li><a href="/vueRouter3/prepare/entry.html" class="sidebar-link">源码入口</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>初始化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/init/" class="sidebar-link">前言</a></li><li><a href="/vueRouter3/init/install.html" class="sidebar-link">注册插件</a></li><li><a href="/vueRouter3/init/instantiate.html" class="sidebar-link">实例化</a></li><li><a href="/vueRouter3/init/mount.html" class="sidebar-link">挂载</a></li><li><a href="/vueRouter3/init/addComponent.html" class="sidebar-link">使用组件</a></li><li><a href="/vueRouter3/init/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>路由匹配</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/matcher/" aria-current="page" class="sidebar-link">路由介绍</a></li><li><a href="/vueRouter3/matcher/matcher.html" aria-current="page" class="active sidebar-link">匹配器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#数据结构" class="sidebar-link">数据结构</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#createroutemap" class="sidebar-link">createRouteMap</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#addrouterecord" class="sidebar-link">addRouteRecord</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#addroute" class="sidebar-link">addRoute</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#addroutes" class="sidebar-link">addRoutes</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#getroutes" class="sidebar-link">getRoutes</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/matcher/matcher.html#match" class="sidebar-link">match</a></li></ul></li><li><a href="/vueRouter3/matcher/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>路由模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/mode/" class="sidebar-link">简介</a></li><li><a href="/vueRouter3/mode/history.html" class="sidebar-link">History模式</a></li><li><a href="/vueRouter3/mode/hash.html" class="sidebar-link">Hash模式</a></li><li><a href="/vueRouter3/mode/abstract.html" class="sidebar-link">Abstract模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/advanced/navigation-guards.html" class="sidebar-link">导航守卫</a></li><li><a href="/vueRouter3/advanced/route-view.html" class="sidebar-link">&lt;router-view&gt;</a></li><li><a href="/vueRouter3/advanced/route-link.html" class="sidebar-link">&lt;router-link&gt;</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="匹配器"><a href="#匹配器" class="header-anchor">#</a> 匹配器</h1> <p>在<code>Vue Route</code>中，路由匹配是通过<code>matcher</code>相关的方法来实现的。我们先来看一下 <code>matcher</code> 的定义：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/create-matcher.js</span>

<span class="token keyword">export</span> type Matcher <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">match</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">raw</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span> current<span class="token operator">?</span><span class="token operator">:</span> Route<span class="token punctuation">,</span> redirectedFrom<span class="token operator">?</span><span class="token operator">:</span> Location</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Route<span class="token punctuation">;</span>
  <span class="token function-variable function">addRoutes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">routes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteConfig<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function-variable function">addRoute</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">parentNameOrRoute</span><span class="token operator">:</span> string <span class="token operator">|</span> RouteConfig<span class="token punctuation">,</span> route<span class="token operator">?</span><span class="token operator">:</span> RouteConfig</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function-variable function">getRoutes</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Array<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424890-9644">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// src/create-matcher.js

export type Matcher = {
  match: (raw: RawLocation, current?: Route, redirectedFrom?: Location) =&gt; Route;
  addRoutes: (routes: Array&lt;RouteConfig&gt;) =&gt; void;
  addRoute: (parentNameOrRoute: string | RouteConfig, route?: RouteConfig) =&gt; void;
  getRoutes: () =&gt; Array&lt;RouteRecord&gt;;
};
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424890-9644" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>matcher</code>上有多个方法可供使用：</p> <ul><li><code>match</code>: 匹配 route</li> <li><code>addRoutes</code>: 批量新增 route 路由数据</li> <li><code>addRoutes</code>: 添加一条 route 路由数据，可指定被添加路由的父级路由</li> <li><code>getRoutes</code>: 获取所有的路由</li></ul> <p>在研究这几个方法之前，我们先来了解一下上面几个方法中提到的几个数据结构</p> <h2 id="数据结构"><a href="#数据结构" class="header-anchor">#</a> 数据结构</h2> <h3 id="location"><a href="#location" class="header-anchor">#</a> Location</h3> <p><code>Location</code> 数据结构和浏览器提供的 <code>window.location</code> 部分结构有点类似，它们都是对 <code>url</code> 的结构化描述。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Location</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当前页面的名称</span>
  name<span class="token operator">?</span><span class="token operator">:</span> string
  <span class="token comment">// 当前页面的路径</span>
  path<span class="token operator">?</span><span class="token operator">:</span> string
  <span class="token comment">// 当前页面的hash</span>
  hash<span class="token operator">?</span><span class="token operator">:</span> string
  <span class="token comment">// 当前页面的查询参数</span>
  query<span class="token operator">?</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>string <span class="token operator">|</span> <span class="token punctuation">(</span>string <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span>
  <span class="token comment">// 当前页面的动态匹配参数</span>
  params<span class="token operator">?</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
  <span class="token comment">// 在当前页面的路径后面追加新的路径，而不是替换当前路径</span>
  append<span class="token operator">?</span><span class="token operator">:</span> boolean
  <span class="token comment">// 在页面导航时使用替换而不是添加的方式</span>
  replace<span class="token operator">?</span><span class="token operator">:</span> boolean
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424890-37283">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export interface Location {
  // 当前页面的名称
  name?: string
  // 当前页面的路径
  path?: string
  // 当前页面的hash
  hash?: string
  // 当前页面的查询参数
  query?: Dictionary&lt;string | (string | null)[] | null | undefined&gt;
  // 当前页面的动态匹配参数
  params?: Dictionary&lt;string&gt;
  // 在当前页面的路径后面追加新的路径，而不是替换当前路径
  append?: boolean
  // 在页面导航时使用替换而不是添加的方式
  replace?: boolean
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424890-37283" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>从上述定义中可以知道<code>Location</code> 对象包含了当前页面的路径、查询参数和哈希值等信息，以便 <code>Vue Router</code> 可以根据该对象来管理路由状态。</p> <h3 id="route"><a href="#route" class="header-anchor">#</a> Route</h3> <p><code>Route</code> 对象包含了与当前路由相关的所有信息</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Route</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当前路由的路径</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> string
  <span class="token comment">// 当前路由的名称</span>
  name<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">null</span>
  <span class="token comment">// 当前路由的hash</span>
  <span class="token literal-property property">hash</span><span class="token operator">:</span> string
  <span class="token comment">// 当前路由的查询参数</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>string <span class="token operator">|</span> <span class="token punctuation">(</span>string <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
  <span class="token comment">// 当前路由的动态匹配参数</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
  <span class="token comment">// 当前路由的完整路径，包括基本URL、路径、查询参数和哈希值</span>
  <span class="token literal-property property">fullPath</span><span class="token operator">:</span> string
  <span class="token comment">// 当前路由匹配的 RouteRecord 对象数组</span>
  <span class="token literal-property property">matched</span><span class="token operator">:</span> RouteRecord<span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 如果当前路由是由其他路由重定向而来，存储重定向来源路由的路径</span>
  redirectedFrom<span class="token operator">?</span><span class="token operator">:</span> string
  <span class="token comment">// 当前路由的元信息，可以包含自定义数据来提供额外的路由信息</span>
  meta<span class="token operator">?</span><span class="token operator">:</span> RouteMeta
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424891-31011">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export interface Route {
  // 当前路由的路径
  path: string
  // 当前路由的名称
  name?: string | null
  // 当前路由的hash
  hash: string
  // 当前路由的查询参数
  query: Dictionary&lt;string | (string | null)[]&gt;
  // 当前路由的动态匹配参数
  params: Dictionary&lt;string&gt;
  // 当前路由的完整路径，包括基本URL、路径、查询参数和哈希值
  fullPath: string
  // 当前路由匹配的 RouteRecord 对象数组
  matched: RouteRecord[]
  // 如果当前路由是由其他路由重定向而来，存储重定向来源路由的路径
  redirectedFrom?: string
  // 当前路由的元信息，可以包含自定义数据来提供额外的路由信息
  meta?: RouteMeta
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424891-31011" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="routerecord"><a href="#routerecord" class="header-anchor">#</a> RouteRecord</h3> <p><code>RouteRecord</code> 是在 <code>Vue Router</code> 中表示路由记录的对象类型。每个路由记录都对应着一个路由配置，用于管理路由和组件的映射关系。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">RouteRecord</span> <span class="token punctuation">{</span>
  <span class="token comment">// 路由的路径</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> string
  <span class="token comment">// 用于匹配路由的正则表达式</span>
  <span class="token literal-property property">regex</span><span class="token operator">:</span> RegExp
  <span class="token comment">// 用于命名视图的多个组件配置</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span>
  <span class="token comment">// 组件实例字典，用于存储命名视图对应的组件实例</span>
  <span class="token literal-property property">instances</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>Vue<span class="token operator">&gt;</span>
  <span class="token comment">// 路由的名称</span>
  name<span class="token operator">?</span><span class="token operator">:</span> string
  <span class="token comment">// 父级路由记录</span>
  parent<span class="token operator">?</span><span class="token operator">:</span> RouteRecord
  <span class="token comment">// 路由重定向的配置</span>
  redirect<span class="token operator">?</span><span class="token operator">:</span> RedirectOption
  <span class="token comment">// 路由别名的路径，用于表示路由的别名</span>
  matchAs<span class="token operator">?</span><span class="token operator">:</span> string
  <span class="token comment">// 路由的元信息，用于存储与路由相关的自定义信息</span>
  <span class="token literal-property property">meta</span><span class="token operator">:</span> RouteMeta
  <span class="token comment">// 路由独享的守卫函数，用于在进入该路由之前执行特定的导航守卫逻辑</span>
  beforeEnter<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token literal-property property">route</span><span class="token operator">:</span> Route<span class="token punctuation">,</span>
    <span class="token function-variable function">redirect</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">location</span><span class="token operator">:</span> RawLocation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any
  <span class="token comment">// 路由组件的属性配置，用于传递参数给路由组件</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span>
    <span class="token operator">|</span> boolean
    <span class="token operator">|</span> Object
    <span class="token operator">|</span> RoutePropsFunction
    <span class="token operator">|</span> Dictionary<span class="token operator">&lt;</span>boolean <span class="token operator">|</span> Object <span class="token operator">|</span> RoutePropsFunction<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424891-5585">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export interface RouteRecord {
  // 路由的路径
  path: string
  // 用于匹配路由的正则表达式
  regex: RegExp
  // 用于命名视图的多个组件配置
  components: Dictionary&lt;Component&gt;
  // 组件实例字典，用于存储命名视图对应的组件实例
  instances: Dictionary&lt;Vue&gt;
  // 路由的名称
  name?: string
  // 父级路由记录
  parent?: RouteRecord
  // 路由重定向的配置
  redirect?: RedirectOption
  // 路由别名的路径，用于表示路由的别名
  matchAs?: string
  // 路由的元信息，用于存储与路由相关的自定义信息
  meta: RouteMeta
  // 路由独享的守卫函数，用于在进入该路由之前执行特定的导航守卫逻辑
  beforeEnter?: (
    route: Route,
    redirect: (location: RawLocation) =&gt; void,
    next: () =&gt; void
  ) =&gt; any
  // 路由组件的属性配置，用于传递参数给路由组件
  props:
    | boolean
    | Object
    | RoutePropsFunction
    | Dictionary&lt;boolean | Object | RoutePropsFunction&gt;
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424891-5585" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>搞明白上述类型的含义后，我们就开始分析<code>matcher</code></p> <h2 id="createroutemap"><a href="#createroutemap" class="header-anchor">#</a> createRouteMap</h2> <p>还记得我们介绍初始化过程的时候，有这么一段代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>matcher <span class="token operator">=</span> <span class="token function">createMatcher</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>routes <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424891-96932">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="this.matcher = createMatcher(options.routes || [], this)
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424891-96932" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当时我们介绍的时候说<code>createMatcher</code>会将 <code>route config</code> 数据转化为 <code>record</code>，我们从这里开始对<code>matcher</code>的分析，源码在<code>src/create-matcher.js</code>，简化代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createMatcher</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">routes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteConfig<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">router</span><span class="token operator">:</span> VueRouter</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Matcher <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createRouteMap</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  <span class="token keyword">function</span> <span class="token function">getRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">addRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    match<span class="token punctuation">,</span>
    addRoute<span class="token punctuation">,</span>
    getRoutes<span class="token punctuation">,</span>
    addRoutes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424891-66414">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export function createMatcher (
  routes: Array&lt;RouteConfig&gt;,
  router: VueRouter
): Matcher {
  const { pathList, pathMap, nameMap } = createRouteMap(routes)

  function addRoute() {}
  
  function getRoutes() {}

  function addRoutes() {}

  return {
    match,
    addRoute,
    getRoutes,
    addRoutes
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424891-66414" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>从上述代码中，可以看出，调用<code>createMatcher</code>时，主要是调用了<code>createRouteMap</code>方法，其余方法都是在此基础上定义的方法。我们继续找<code>createRouteMap</code>的定义，源码在<code>src/create-matcher.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRouteMap</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">routes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteConfig<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  oldPathList<span class="token operator">?</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  oldPathMap<span class="token operator">?</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  oldNameMap<span class="token operator">?</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  parentRoute<span class="token operator">?</span><span class="token operator">:</span> RouteRecord</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">pathList</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pathMap</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">nameMap</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span>
<span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token comment">// 存放所有路由的 path</span>
  <span class="token keyword">const</span> <span class="token literal-property property">pathList</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> oldPathList <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 以 path 作为 key，存放所有的路由描述的Map</span>
  <span class="token keyword">const</span> <span class="token literal-property property">pathMap</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span> <span class="token operator">=</span> oldPathMap <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token comment">// 以 name 作为 key，存放所有的路由描述的Map</span>
  <span class="token keyword">const</span> <span class="token literal-property property">nameMap</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span> <span class="token operator">=</span> oldNameMap <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token comment">// routes 是一个数组对象。也就是用户手写的 new VueRouter( { routes: [xxx] } ) 的 routes 配置数据</span>
  <span class="token comment">// 遍历routes数组的数据，将所有元素转化为 router record 对象。且会被记录到 pathMap, nameMap 对象中。</span>
  routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">addRouteRecord</span><span class="token punctuation">(</span>pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap<span class="token punctuation">,</span> route<span class="token punctuation">,</span> parentRoute<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 处理 pathList 中的 path == * 的路径，且移到数组末尾。</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> pathList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pathList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// pathList.splice(i, 1) 移除当前元素，返回移除元素的数组</span>
      <span class="token comment">// pathList.push 将移除的元素放到数组末尾</span>
      pathList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pathList<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// 最后一个是当前元素，无需重新处理</span>
      l<span class="token operator">--</span>
      <span class="token comment">// 数组发生变更，重新处理新的第i位元素</span>
      i<span class="token operator">--</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    pathList<span class="token punctuation">,</span>
    pathMap<span class="token punctuation">,</span>
    nameMap
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424891-57038">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export function createRouteMap (
  routes: Array&lt;RouteConfig&gt;,
  oldPathList?: Array&lt;string&gt;,
  oldPathMap?: Dictionary&lt;RouteRecord&gt;,
  oldNameMap?: Dictionary&lt;RouteRecord&gt;,
  parentRoute?: RouteRecord
): {
  pathList: Array&lt;string&gt;,
  pathMap: Dictionary&lt;RouteRecord&gt;,
  nameMap: Dictionary&lt;RouteRecord&gt;
} {
  // 存放所有路由的 path
  const pathList: Array&lt;string&gt; = oldPathList || []
  // 以 path 作为 key，存放所有的路由描述的Map
  const pathMap: Dictionary&lt;RouteRecord&gt; = oldPathMap || Object.create(null)
  // 以 name 作为 key，存放所有的路由描述的Map
  const nameMap: Dictionary&lt;RouteRecord&gt; = oldNameMap || Object.create(null)

  // routes 是一个数组对象。也就是用户手写的 new VueRouter( { routes: [xxx] } ) 的 routes 配置数据
  // 遍历routes数组的数据，将所有元素转化为 router record 对象。且会被记录到 pathMap, nameMap 对象中。
  routes.forEach(route =&gt; {
    addRouteRecord(pathList, pathMap, nameMap, route, parentRoute)
  })

  // 处理 pathList 中的 path == * 的路径，且移到数组末尾。
  for (let i = 0, l = pathList.length; i &lt; l; i++) {
    if (pathList[i] === '*') {
      // pathList.splice(i, 1) 移除当前元素，返回移除元素的数组
      // pathList.push 将移除的元素放到数组末尾
      pathList.push(pathList.splice(i, 1)[0])
      // 最后一个是当前元素，无需重新处理
      l--
      // 数组发生变更，重新处理新的第i位元素
      i--
    }
  }

  return {
    pathList,
    pathMap,
    nameMap
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424891-57038" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><code>createRouteMap</code>先定义了三个变量</p> <ol><li><code>pathList</code>: 存放所有路由的 <code>path</code></li> <li><code>pathMap</code>: 以 <code>path</code> 作为 <code>key</code>，存放所有的路由描述的<code>Map</code></li> <li><code>nameMap</code>: 以 <code>name</code> 作为 <code>key</code>，存放所有的路由描述的<code>Map</code></li></ol> <p>这三个变量，也就是<code>createRouteMap</code>最终返回的数据，这个数据结构就跟我们之前分析的匹配思路很相似了。</p> <p>接下来，循环<code>routes</code>调用<code>addRouteRecord</code>，将数据统一转为<code>RouteRecord</code>对象，<code>addRouteRecord</code>具体源码我们稍后分析，先顺着主线思路梳理。</p> <p>循环<code>routes</code>完毕后，上述的三个变量就已经完成了添加，然后再对<code>pathList</code>处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> pathList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// pathList.splice(i, 1) 移除当前元素，返回移除元素的数组</span>
    <span class="token comment">// pathList.push 将移除的元素放到数组末尾</span>
    pathList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pathList<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// 最后一个是当前元素，无需重新处理</span>
    l<span class="token operator">--</span>
    <span class="token comment">// 数组发生变更，重新处理新的第i位元素</span>
    i<span class="token operator">--</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424891-19580">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="for (let i = 0, l = pathList.length; i &lt; l; i++) {
  if (pathList[i] === '*') {
    // pathList.splice(i, 1) 移除当前元素，返回移除元素的数组
    // pathList.push 将移除的元素放到数组末尾
    pathList.push(pathList.splice(i, 1)[0])
    // 最后一个是当前元素，无需重新处理
    l--
    // 数组发生变更，重新处理新的第i位元素
    i--
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424891-19580" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上述代码是处理 <code>pathList</code> 中的 <code>path === *</code> 的路径，且移到数组末尾，这样是为了确保首先匹配更具体的路由，并且仅在没有其他匹配项时才回退到<code>*</code>路由</p> <p>最后，返回<code>pathList</code>、<code>pathMap</code>、<code>nameMap</code>三个变量，完成<code>createRouteMap</code>的逻辑。</p> <h2 id="addrouterecord"><a href="#addrouterecord" class="header-anchor">#</a> addRouteRecord</h2> <p><code>addRouteRecord</code>的逻辑很简单，将<code>route</code>对象转为<code>RouteRecord</code>对象，其中<code>route.path</code> 使用<code>path-to-regexp</code>转换成正则表达式，然后将<code>RouteRecord</code>对象添加到<code>pathMap</code>、<code>nameMap</code>中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addRouteRecord</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">pathList</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">pathMap</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">nameMap</span><span class="token operator">:</span> Dictionary<span class="token operator">&lt;</span>RouteRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">route</span><span class="token operator">:</span> RouteConfig<span class="token punctuation">,</span>
  parent<span class="token operator">?</span><span class="token operator">:</span> RouteRecord<span class="token punctuation">,</span>
  matchAs<span class="token operator">?</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
    正常的route 数据为：
      {
        name: xxx,
        path: xxx,
        component: xxx,
        children: [ {
          name: xxx,
          path: xxx,
          component: xxx,
        }]
        meta: xxx
      }
  */</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> route

  <span class="token comment">// pathToRegexpOptions 表示编译正则的选项。</span>
  <span class="token comment">// 可以通过配置 route 的 pathToRegexpOptions 参数添加高级配选项。默认是空对象</span>
  <span class="token keyword">const</span> <span class="token literal-property property">pathToRegexpOptions</span><span class="token operator">:</span> PathToRegexpOptions <span class="token operator">=</span>
    route<span class="token punctuation">.</span>pathToRegexpOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 格式化路径路径名称</span>
  <span class="token comment">// 绝对路径直接返回，相对路径就拼接父路由的path</span>
  <span class="token keyword">const</span> normalizedPath <span class="token operator">=</span> <span class="token function">normalizePath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> pathToRegexpOptions<span class="token punctuation">.</span>strict<span class="token punctuation">)</span>

  <span class="token comment">// route.caseSensitive 属性如果存在，则设置到 pathToRegexpOptions 中。</span>
  <span class="token comment">// caseSensitive： 表示大小写敏感。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> route<span class="token punctuation">.</span>caseSensitive <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pathToRegexpOptions<span class="token punctuation">.</span>sensitive <span class="token operator">=</span> route<span class="token punctuation">.</span>caseSensitive
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token literal-property property">record</span><span class="token operator">:</span> RouteRecord <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 完整的绝对路径</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> normalizedPath<span class="token punctuation">,</span>
    <span class="token comment">// 根据完整的路径，以及路径匹配配置参数，生成路径匹配正则对象</span>
    <span class="token literal-property property">regex</span><span class="token operator">:</span> <span class="token function">compileRouteRegex</span><span class="token punctuation">(</span>normalizedPath<span class="token punctuation">,</span> pathToRegexpOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 设置 components</span>
    <span class="token comment">// 如果是别名路由的创建，则 components 为 undefined。</span>
    <span class="token literal-property property">components</span><span class="token operator">:</span> route<span class="token punctuation">.</span>components <span class="token operator">||</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> route<span class="token punctuation">.</span>component <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 设置路由别名。别名类似于重定向，但是显示的路径会是别名的路径。</span>
    <span class="token comment">// 别名可以设置多个，用数组表示；如果只有一个且是字符串，则格式化为数组。</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> route<span class="token punctuation">.</span>alias
      <span class="token operator">?</span> <span class="token keyword">typeof</span> route<span class="token punctuation">.</span>alias <span class="token operator">===</span> <span class="token string">'string'</span>
        <span class="token operator">?</span> <span class="token punctuation">[</span>route<span class="token punctuation">.</span>alias<span class="token punctuation">]</span>
        <span class="token operator">:</span> route<span class="token punctuation">.</span>alias
      <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">instances</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enteredCbs</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token punctuation">,</span>
    <span class="token comment">// 父路由 record 对象</span>
    parent<span class="token punctuation">,</span>
    <span class="token comment">// 如果是 root route, 则 matchAS 为 undefined</span>
    matchAs<span class="token punctuation">,</span>
    <span class="token comment">// 记录路由的 redirect 重定向属性</span>
    <span class="token literal-property property">redirect</span><span class="token operator">:</span> route<span class="token punctuation">.</span>redirect<span class="token punctuation">,</span>
    <span class="token comment">// 当前路由单独定义的路由守卫</span>
    <span class="token literal-property property">beforeEnter</span><span class="token operator">:</span> route<span class="token punctuation">.</span>beforeEnter<span class="token punctuation">,</span>
    <span class="token comment">// 记录 route 元数据。一般用于配置keepalive, required 等</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> route<span class="token punctuation">.</span>meta <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 如果没配置有 route.props，则默认为空对象。</span>
    <span class="token comment">// 如果配置有 route.props, 则如果 component 存在，则记录 route.props 数据。</span>
    <span class="token comment">// 说明： props 类似于 query, params，都是用于携带路由传参的。不过 props 会自动把数据传递到组件的 props 中</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span>
      route<span class="token punctuation">.</span>props <span class="token operator">==</span> <span class="token keyword">null</span>
        <span class="token operator">?</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">:</span> route<span class="token punctuation">.</span>components
          <span class="token operator">?</span> route<span class="token punctuation">.</span>props
          <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> route<span class="token punctuation">.</span>props <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果有子路由</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历子路由生成record对象</span>
    route<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果 route 是用户真实配置的 route 数据，则 matchAs 为 undefine。</span>
      <span class="token comment">// 如果 route 是 alias 生成的 route 数据，则 matchAs 为被别名的完整路径。</span>
      <span class="token comment">// 子 route 通过 matchAs 记录没有被别名的完整路径</span>
      <span class="token keyword">const</span> childMatchAs <span class="token operator">=</span> matchAs
        <span class="token operator">?</span> <span class="token function">cleanPath</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>matchAs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>child<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token keyword">undefined</span>
      <span class="token function">addRouteRecord</span><span class="token punctuation">(</span>pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap<span class="token punctuation">,</span> child<span class="token punctuation">,</span> record<span class="token punctuation">,</span> childMatchAs<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果 record.path 没有被记录到 pathMap 中。</span>
  <span class="token comment">// 后面出现相同的 record.path，相当于直接丢弃。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pathMap<span class="token punctuation">[</span>record<span class="token punctuation">.</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pathList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
    pathMap<span class="token punctuation">[</span>record<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> record
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果设置了别名</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>alias <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 格式化别名，后续统一为数组处理</span>
    <span class="token keyword">const</span> aliases <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>alias<span class="token punctuation">)</span> <span class="token operator">?</span> route<span class="token punctuation">.</span>alias <span class="token operator">:</span> <span class="token punctuation">[</span>route<span class="token punctuation">.</span>alias<span class="token punctuation">]</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> aliases<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> alias <span class="token operator">=</span> aliases<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

      <span class="token comment">// 将alias封装为route，生成对应的record</span>
      <span class="token keyword">const</span> aliasRoute <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> alias<span class="token punctuation">,</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> route<span class="token punctuation">.</span>children
      <span class="token punctuation">}</span>
      <span class="token function">addRouteRecord</span><span class="token punctuation">(</span>
        pathList<span class="token punctuation">,</span>
        pathMap<span class="token punctuation">,</span>
        nameMap<span class="token punctuation">,</span>
        aliasRoute<span class="token punctuation">,</span>
        parent<span class="token punctuation">,</span>
        <span class="token comment">// record.path 就是被别名的 path 的完整路径。</span>
        record<span class="token punctuation">.</span>path <span class="token operator">||</span> <span class="token string">'/'</span> <span class="token comment">// matchAs</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 如果 route.name 存在，则记录到nameMap中</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不重复记录</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nameMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nameMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> record
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424892-26378">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="function addRouteRecord (
  pathList: Array&lt;string&gt;,
  pathMap: Dictionary&lt;RouteRecord&gt;,
  nameMap: Dictionary&lt;RouteRecord&gt;,
  route: RouteConfig,
  parent?: RouteRecord,
  matchAs?: string
) {
  /*
    正常的route 数据为：
      {
        name: xxx,
        path: xxx,
        component: xxx,
        children: [ {
          name: xxx,
          path: xxx,
          component: xxx,
        }]
        meta: xxx
      }
  */
  const { path, name } = route

  // pathToRegexpOptions 表示编译正则的选项。
  // 可以通过配置 route 的 pathToRegexpOptions 参数添加高级配选项。默认是空对象
  const pathToRegexpOptions: PathToRegexpOptions =
    route.pathToRegexpOptions || {}
  // 格式化路径路径名称
  // 绝对路径直接返回，相对路径就拼接父路由的path
  const normalizedPath = normalizePath(path, parent, pathToRegexpOptions.strict)

  // route.caseSensitive 属性如果存在，则设置到 pathToRegexpOptions 中。
  // caseSensitive： 表示大小写敏感。
  if (typeof route.caseSensitive === 'boolean') {
    pathToRegexpOptions.sensitive = route.caseSensitive
  }

  const record: RouteRecord = {
    // 完整的绝对路径
    path: normalizedPath,
    // 根据完整的路径，以及路径匹配配置参数，生成路径匹配正则对象
    regex: compileRouteRegex(normalizedPath, pathToRegexpOptions),
    // 设置 components
    // 如果是别名路由的创建，则 components 为 undefined。
    components: route.components || { default: route.component },
    // 设置路由别名。别名类似于重定向，但是显示的路径会是别名的路径。
    // 别名可以设置多个，用数组表示；如果只有一个且是字符串，则格式化为数组。
    alias: route.alias
      ? typeof route.alias === 'string'
        ? [route.alias]
        : route.alias
      : [],
    instances: {},
    enteredCbs: {},
    name,
    // 父路由 record 对象
    parent,
    // 如果是 root route, 则 matchAS 为 undefined
    matchAs,
    // 记录路由的 redirect 重定向属性
    redirect: route.redirect,
    // 当前路由单独定义的路由守卫
    beforeEnter: route.beforeEnter,
    // 记录 route 元数据。一般用于配置keepalive, required 等
    meta: route.meta || {},
    // 如果没配置有 route.props，则默认为空对象。
    // 如果配置有 route.props, 则如果 component 存在，则记录 route.props 数据。
    // 说明： props 类似于 query, params，都是用于携带路由传参的。不过 props 会自动把数据传递到组件的 props 中
    props:
      route.props == null
        ? {}
        : route.components
          ? route.props
          : { default: route.props }
  }

  // 如果有子路由
  if (route.children) {
    // 遍历子路由生成record对象
    route.children.forEach(child =&gt; {
      // 如果 route 是用户真实配置的 route 数据，则 matchAs 为 undefine。
      // 如果 route 是 alias 生成的 route 数据，则 matchAs 为被别名的完整路径。
      // 子 route 通过 matchAs 记录没有被别名的完整路径
      const childMatchAs = matchAs
        ? cleanPath(`${matchAs}/${child.path}`)
        : undefined
      addRouteRecord(pathList, pathMap, nameMap, child, record, childMatchAs)
    })
  }

  // 如果 record.path 没有被记录到 pathMap 中。
  // 后面出现相同的 record.path，相当于直接丢弃。
  if (!pathMap[record.path]) {
    pathList.push(record.path)
    pathMap[record.path] = record
  }

  // 如果设置了别名
  if (route.alias !== undefined) {
    // 格式化别名，后续统一为数组处理
    const aliases = Array.isArray(route.alias) ? route.alias : [route.alias]

    for (let i = 0; i &lt; aliases.length; ++i) {
      const alias = aliases[i]

      // 将alias封装为route，生成对应的record
      const aliasRoute = {
        path: alias,
        children: route.children
      }
      addRouteRecord(
        pathList,
        pathMap,
        nameMap,
        aliasRoute,
        parent,
        // record.path 就是被别名的 path 的完整路径。
        record.path || '/' // matchAs
      )
    }
  }

  // 如果 route.name 存在，则记录到nameMap中
  if (name) {
    // 不重复记录
    if (!nameMap[name]) {
      nameMap[name] = record
    }
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424892-26378" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br></div></div><p>上述代码看着复杂，实际上逻辑较为简单，主要做了几件事</p> <ol><li>配置编译正则的选项<code>pathToRegexpOptions</code></li> <li>构建<code>RouteRecord</code>对象
<ol><li><code>path</code>为完整路径</li> <li><code>regex</code>为<code>path-to-regexp</code>处理的正则表达式</li></ol></li> <li>如果存在嵌套的子路由，则递归处理</li> <li>将拼接后完整路径的<code>record.path</code> 记录到 <code>pathMap</code> 中</li> <li>如果设置了别名选项<code>alias</code>，则根据别名，再多构建一个<code>RouteRecord</code>对象</li> <li>如果 <code>route.name</code> 存在，则记录到<code>nameMap</code>中</li></ol> <h2 id="addroute"><a href="#addroute" class="header-anchor">#</a> addRoute</h2> <p><code>createRouteMap</code>的逻辑梳理清楚后，我们继续看<code>createMatcher</code>的逻辑</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createMatcher</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">routes</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>RouteConfig<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">router</span><span class="token operator">:</span> VueRouter</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Matcher <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createRouteMap</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  <span class="token keyword">function</span> <span class="token function">getRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">addRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    match<span class="token punctuation">,</span>
    addRoute<span class="token punctuation">,</span>
    getRoutes<span class="token punctuation">,</span>
    addRoutes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424892-55393">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="export function createMatcher (
  routes: Array&lt;RouteConfig&gt;,
  router: VueRouter
): Matcher {
  const { pathList, pathMap, nameMap } = createRouteMap(routes)

  function addRoute() {}
  
  function getRoutes() {}

  function addRoutes() {}

  function match() {}

  return {
    match,
    addRoute,
    getRoutes,
    addRoutes
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424892-55393" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>createMatcher</code>共返回了四个函数，我们挨个分析</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 添加一条 route 路由数据</span>
<span class="token keyword">function</span> <span class="token function">addRoute</span> <span class="token punctuation">(</span><span class="token parameter">parentOrRoute<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果parentOrRoute是字符串，则代表传入的是name，找到对应的route对象，作为父级路由节点</span>
  <span class="token keyword">const</span> parent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> parentOrRoute <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token operator">?</span> nameMap<span class="token punctuation">[</span>parentOrRoute<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token comment">// $flow-disable-line</span>
  <span class="token comment">// 如果只有一个参数，则代表是直接添加到最后</span>
  <span class="token comment">// 如果有两个参数，则第一个参数代表是要添加的父级路由节点，第二个参数为需要添加的路由</span>
  <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span>route <span class="token operator">||</span> parentOrRoute<span class="token punctuation">]</span><span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>

  <span class="token comment">// add aliases of parent</span>
  <span class="token comment">// 针对 parent 存在 alias 的情形，需要将 alias 数据包装成 route，以保证所有包含别名路径的子路由，也能正确访问，</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>alias<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">createRouteMap</span><span class="token punctuation">(</span>
      <span class="token comment">// $flow-disable-line route is defined if parent is</span>
      parent<span class="token punctuation">.</span>alias<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">alias</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> alias<span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>route<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      pathList<span class="token punctuation">,</span>
      pathMap<span class="token punctuation">,</span>
      nameMap<span class="token punctuation">,</span>
      parent
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-70983">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 添加一条 route 路由数据
function addRoute (parentOrRoute, route) {
  // 如果parentOrRoute是字符串，则代表传入的是name，找到对应的route对象，作为父级路由节点
  const parent = (typeof parentOrRoute !== 'object') ? nameMap[parentOrRoute] : undefined
  // $flow-disable-line
  // 如果只有一个参数，则代表是直接添加到最后
  // 如果有两个参数，则第一个参数代表是要添加的父级路由节点，第二个参数为需要添加的路由
  createRouteMap([route || parentOrRoute], pathList, pathMap, nameMap, parent)

  // add aliases of parent
  // 针对 parent 存在 alias 的情形，需要将 alias 数据包装成 route，以保证所有包含别名路径的子路由，也能正确访问，
  if (parent &amp;&amp; parent.alias.length) {
    createRouteMap(
      // $flow-disable-line route is defined if parent is
      parent.alias.map(alias =&gt; ({ path: alias, children: [route] })),
      pathList,
      pathMap,
      nameMap,
      parent
    )
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-70983" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>addRoute</code>有两种用法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 添加一条新路由规则</span>
<span class="token function">addRoute</span><span class="token punctuation">(</span>route<span class="token operator">:</span> RouteConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token comment">// 添加一条新的路由规则记录作为现有路由的子路由</span>
<span class="token function">addRoute</span><span class="token punctuation">(</span>parentName<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">route</span><span class="token operator">:</span> RouteConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-20014">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 添加一条新路由规则
addRoute(route: RouteConfig): () =&gt; void
// 添加一条新的路由规则记录作为现有路由的子路由
addRoute(parentName: string, route: RouteConfig): () =&gt; void
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-20014" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根据传参的不同，实现不同的功能，我们可以将两部分的代码拆开来分析</p> <h3 id="添加新路由"><a href="#添加新路由" class="header-anchor">#</a> 添加新路由</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addRoute</span> <span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果只有一个参数，则代表是直接添加到最后</span>
  <span class="token comment">// 如果有两个参数，则第一个参数代表是要添加的父级路由节点，第二个参数为需要添加的路由</span>
  <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-49843">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="function addRoute (route) {
  // 如果只有一个参数，则代表是直接添加到最后
  // 如果有两个参数，则第一个参数代表是要添加的父级路由节点，第二个参数为需要添加的路由
  createRouteMap([route], pathList, pathMap, nameMap, parent)
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-49843" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果是添加一条新路由规则，则直接调用<code>createRouteMap</code>去处理即可</p> <h3 id="添加新路由到指定路由的子集"><a href="#添加新路由到指定路由的子集" class="header-anchor">#</a> 添加新路由到指定路由的子集</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addRoute</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> parent <span class="token operator">=</span> nameMap<span class="token punctuation">[</span>parent<span class="token punctuation">]</span>
  <span class="token comment">// $flow-disable-line</span>
  <span class="token comment">// 如果只有一个参数，则代表是直接添加到最后</span>
  <span class="token comment">// 如果有两个参数，则第一个参数代表是要添加的父级路由节点，第二个参数为需要添加的路由</span>
  <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>

  <span class="token comment">// add aliases of parent</span>
  <span class="token comment">// 针对 parent 存在 alias 的情形，需要将 alias 数据包装成 route，以保证所有包含别名路径的子路由，也能正确访问，</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>alias<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">createRouteMap</span><span class="token punctuation">(</span>
      <span class="token comment">// $flow-disable-line route is defined if parent is</span>
      parent<span class="token punctuation">.</span>alias<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">alias</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> alias<span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>route<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      pathList<span class="token punctuation">,</span>
      pathMap<span class="token punctuation">,</span>
      nameMap<span class="token punctuation">,</span>
      parent
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-34067">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="function addRoute (parent, route) {
  const parent = nameMap[parent]
  // $flow-disable-line
  // 如果只有一个参数，则代表是直接添加到最后
  // 如果有两个参数，则第一个参数代表是要添加的父级路由节点，第二个参数为需要添加的路由
  createRouteMap([route], pathList, pathMap, nameMap, parent)

  // add aliases of parent
  // 针对 parent 存在 alias 的情形，需要将 alias 数据包装成 route，以保证所有包含别名路径的子路由，也能正确访问，
  if (parent &amp;&amp; parent.alias.length) {
    createRouteMap(
      // $flow-disable-line route is defined if parent is
      parent.alias.map(alias =&gt; ({ path: alias, children: [route] })),
      pathList,
      pathMap,
      nameMap,
      parent
    )
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-34067" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>相比于单独添加新路由的实现来说，这里针对<code>parent</code> 存在 <code>alias</code> 的情形做了处理，需要将<code>alias</code>处理后的路由添加到列表中，以保证所有包含别名路径的子路由，也能正确访问</p> <h2 id="addroutes"><a href="#addroutes" class="header-anchor">#</a> addRoutes</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 批量新增 route 路由数据</span>
<span class="token keyword">function</span> <span class="token function">addRoutes</span> <span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果旧的 path 存在，则新的会被忽略掉</span>
  <span class="token comment">// 旧的 path 是不会被移除的</span>
  <span class="token function">createRouteMap</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> nameMap<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-3148">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 批量新增 route 路由数据
function addRoutes (routes) {
  // 如果旧的 path 存在，则新的会被忽略掉
  // 旧的 path 是不会被移除的
  createRouteMap(routes, pathList, pathMap, nameMap)
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-3148" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>addRoutes</code>的逻辑较为简单，只需要重新调用<code>createRouteMap</code>将新的<code>routes</code>传入即可，需要注意的是，由于<code>createRouteMap</code>本身的逻辑，如果在已有路由列表和批量新添加的路由中，存在相同 <code>path</code> 或 <code>name</code> 的情况，则新添加的路由会被忽略掉。</p> <h2 id="getroutes"><a href="#getroutes" class="header-anchor">#</a> getRoutes</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 返回一个数组，包含所有的 router record 对象</span>
<span class="token keyword">function</span> <span class="token function">getRoutes</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> pathList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">path</span> <span class="token operator">=&gt;</span> pathMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-48979">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 返回一个数组，包含所有的 router record 对象
function getRoutes () {
  return pathList.map(path =&gt; pathMap[path])
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-48979" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>getRoutes</code>逻辑比较简单，从<code>pathMap</code>中取出<code>pathList</code>每一项对应的<code>router record</code>对象</p> <h2 id="match"><a href="#match" class="header-anchor">#</a> match</h2> <p>最关键的<code>match</code>函数来了，这个函数是路由匹配的关键</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">match</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">raw</span><span class="token operator">:</span> RawLocation<span class="token punctuation">,</span>
  currentRoute<span class="token operator">?</span><span class="token operator">:</span> Route<span class="token punctuation">,</span>
  redirectedFrom<span class="token operator">?</span><span class="token operator">:</span> Location</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Route <span class="token punctuation">{</span>
  <span class="token comment">// 将 raw 和 currentRoute 分解成为 { path, name, query， params } 的形式。</span>
  <span class="token comment">// 之所以用到 currentRoute, 是针对 raw 没有 path 和 name 时的原页面刷新，或者同一个动态路径页面跳转</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">normalizeLocation</span><span class="token punctuation">(</span>raw<span class="token punctuation">,</span> currentRoute<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> location
  <span class="token comment">// 如果 name, path 同时存在，则优先使用 name</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> record <span class="token operator">=</span> nameMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
    <span class="token comment">// 如果 record 不存在, 则不存在路径。创建相关的 route</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">_createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> location<span class="token punctuation">)</span>

    <span class="token comment">// 获取 record 中所有需要动态匹配的 key。</span>
    <span class="token comment">// 比如路径为： /:user/:name, 则 paramNames 为 [&quot;user&quot;, &quot;name&quot;]</span>
    <span class="token keyword">const</span> paramNames <span class="token operator">=</span> record<span class="token punctuation">.</span>regex<span class="token punctuation">.</span>keys
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>key<span class="token punctuation">.</span>optional<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> key<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> location<span class="token punctuation">.</span>params <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      location<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 通过将currentRoute的params复制给location.params，来汇总当前所有params</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentRoute <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> currentRoute<span class="token punctuation">.</span>params <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 遍历 current route 的 params</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> currentRoute<span class="token punctuation">.</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> location<span class="token punctuation">.</span>params<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> paramNames<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          location<span class="token punctuation">.</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> currentRoute<span class="token punctuation">.</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 根据location.params 替换record.path的动态路径</span>
    location<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token function">fillParams</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>path<span class="token punctuation">,</span> location<span class="token punctuation">.</span>params<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">named route &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// 输出route对象</span>
    <span class="token keyword">return</span> <span class="token function">_createRoute</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> location<span class="token punctuation">,</span> redirectedFrom<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    location<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pathList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取 path 对应的 record 对象</span>
      <span class="token keyword">const</span> path <span class="token operator">=</span> pathList<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">const</span> record <span class="token operator">=</span> pathMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span>
      <span class="token comment">// 判断是否通过 path 是否能找到对应的 record。</span>
      <span class="token comment">// 特别注意：location.params 经过 matchRoute()调用后，对于动态路由路径，会存储 url 上对应动态字段的数据。</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">matchRoute</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>regex<span class="token punctuation">,</span> location<span class="token punctuation">.</span>path<span class="token punctuation">,</span> location<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">_createRoute</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> location<span class="token punctuation">,</span> redirectedFrom<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// no match</span>
  <span class="token comment">// 没有匹配到，直接返回空route对象</span>
  <span class="token keyword">return</span> <span class="token function">_createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> location<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1701341424893-15287">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="function match (
  raw: RawLocation,
  currentRoute?: Route,
  redirectedFrom?: Location
): Route {
  // 将 raw 和 currentRoute 分解成为 { path, name, query， params } 的形式。
  // 之所以用到 currentRoute, 是针对 raw 没有 path 和 name 时的原页面刷新，或者同一个动态路径页面跳转
  const location = normalizeLocation(raw, currentRoute, false, router)
  const { name } = location
  // 如果 name, path 同时存在，则优先使用 name
  if (name) {
    const record = nameMap[name]
    // 如果 record 不存在, 则不存在路径。创建相关的 route
    if (!record) return _createRoute(null, location)

    // 获取 record 中所有需要动态匹配的 key。
    // 比如路径为： /:user/:name, 则 paramNames 为 [&quot;user&quot;, &quot;name&quot;]
    const paramNames = record.regex.keys
      .filter(key =&gt; !key.optional)
      .map(key =&gt; key.name)

    if (typeof location.params !== 'object') {
      location.params = {}
    }

    // 通过将currentRoute的params复制给location.params，来汇总当前所有params
    if (currentRoute &amp;&amp; typeof currentRoute.params === 'object') {
      // 遍历 current route 的 params
      for (const key in currentRoute.params) {
        if (!(key in location.params) &amp;&amp; paramNames.indexOf(key) &gt; -1) {
          location.params[key] = currentRoute.params[key]
        }
      }
    }
    // 根据location.params 替换record.path的动态路径
    location.path = fillParams(record.path, location.params, `named route &quot;${name}&quot;`)
    // 输出route对象
    return _createRoute(record, location, redirectedFrom)
  } else if (location.path) {
    location.params = {}
    for (let i = 0; i &lt; pathList.length; i++) {
      // 获取 path 对应的 record 对象
      const path = pathList[i]
      const record = pathMap[path]
      // 判断是否通过 path 是否能找到对应的 record。
      // 特别注意：location.params 经过 matchRoute()调用后，对于动态路由路径，会存储 url 上对应动态字段的数据。
      if (matchRoute(record.regex, location.path, location.params)) {
        return _createRoute(record, location, redirectedFrom)
      }
    }
  }
  // no match
  // 没有匹配到，直接返回空route对象
  return _createRoute(null, location)
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1701341424893-15287" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>上述代码逻辑中，主要做了几件事</p> <ol><li>调用<code>normalizeLocation</code>处理路由，计算出对应的<code>location</code>对象</li> <li>如果<code>location</code>中<code>name</code>存在，则在<code>nameMap</code>中匹配<code>name</code> <ol><li>如果没匹配到，调用<code>_createRoute</code>创建对应的空<code>Route</code>对象</li> <li>如果匹配到，则汇总当前所有<code>params</code>，匹配动态路由对应的参数，创建对应的<code>Route</code>对象</li></ol></li> <li>如果<code>location</code>中<code>path</code>存在，用<code>path</code>找到<code>pathMap</code>对应的 <code>record</code>，并处理动态路由路径，创建对应的<code>Route</code>对象</li> <li>如果都没匹配到，则调用<code>_createRoute</code>创建对应的空<code>Route</code>对象</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vueRouter3/matcher/" class="prev router-link-active">
        路由介绍
      </a></span> <span class="next"><a href="/vueRouter3/matcher/summary.html">
        总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.41678a85.js" defer></script><script src="/assets/js/2.88c18509.js" defer></script><script src="/assets/js/1.d4c099ff.js" defer></script><script src="/assets/js/90.dc287682.js" defer></script>
  </body>
</html>
