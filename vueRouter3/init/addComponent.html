<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用组件 | 前端源码解读</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="前端源码解读文档;使用过程中如碰到问题，请到Github进行提问。 https://github.com/CrayonPig/originCodeCommit">
    
    <link rel="preload" href="/assets/css/0.styles.96eb8417.css" as="style"><link rel="preload" href="/assets/js/app.bd142e4f.js" as="script"><link rel="preload" href="/assets/js/2.ff6775b1.js" as="script"><link rel="preload" href="/assets/js/1.1085e0bf.js" as="script"><link rel="preload" href="/assets/js/90.10eca24a.js" as="script"><link rel="prefetch" href="/assets/js/10.798a13dc.js"><link rel="prefetch" href="/assets/js/100.7993b243.js"><link rel="prefetch" href="/assets/js/101.9807c2de.js"><link rel="prefetch" href="/assets/js/102.cf5b6478.js"><link rel="prefetch" href="/assets/js/103.f5122834.js"><link rel="prefetch" href="/assets/js/104.12cdd711.js"><link rel="prefetch" href="/assets/js/105.b8e11a5c.js"><link rel="prefetch" href="/assets/js/106.747c0a4c.js"><link rel="prefetch" href="/assets/js/107.d9541280.js"><link rel="prefetch" href="/assets/js/108.b357b164.js"><link rel="prefetch" href="/assets/js/109.142b2cc2.js"><link rel="prefetch" href="/assets/js/11.9075ffd6.js"><link rel="prefetch" href="/assets/js/110.20df3303.js"><link rel="prefetch" href="/assets/js/111.42497fb2.js"><link rel="prefetch" href="/assets/js/112.16ed3f20.js"><link rel="prefetch" href="/assets/js/113.24dee4c3.js"><link rel="prefetch" href="/assets/js/114.bb0ef6ad.js"><link rel="prefetch" href="/assets/js/115.7255742f.js"><link rel="prefetch" href="/assets/js/116.45860f7b.js"><link rel="prefetch" href="/assets/js/117.0d1942af.js"><link rel="prefetch" href="/assets/js/118.fd2de7f9.js"><link rel="prefetch" href="/assets/js/119.c65feb93.js"><link rel="prefetch" href="/assets/js/12.8ad83654.js"><link rel="prefetch" href="/assets/js/120.1a2f766c.js"><link rel="prefetch" href="/assets/js/13.38f8b466.js"><link rel="prefetch" href="/assets/js/14.4feb982d.js"><link rel="prefetch" href="/assets/js/15.7ba29c3c.js"><link rel="prefetch" href="/assets/js/16.01affe3e.js"><link rel="prefetch" href="/assets/js/17.7cf9cc51.js"><link rel="prefetch" href="/assets/js/18.ae4486b4.js"><link rel="prefetch" href="/assets/js/19.8e825451.js"><link rel="prefetch" href="/assets/js/20.edd797a9.js"><link rel="prefetch" href="/assets/js/21.c65e48bf.js"><link rel="prefetch" href="/assets/js/22.48066223.js"><link rel="prefetch" href="/assets/js/23.7edb15eb.js"><link rel="prefetch" href="/assets/js/24.557855a8.js"><link rel="prefetch" href="/assets/js/25.5a53bd0a.js"><link rel="prefetch" href="/assets/js/26.b3fdf584.js"><link rel="prefetch" href="/assets/js/27.4aa07a45.js"><link rel="prefetch" href="/assets/js/28.9fc050f2.js"><link rel="prefetch" href="/assets/js/29.ea7d19b3.js"><link rel="prefetch" href="/assets/js/3.c46963c6.js"><link rel="prefetch" href="/assets/js/30.596ae1cf.js"><link rel="prefetch" href="/assets/js/31.c04856b0.js"><link rel="prefetch" href="/assets/js/32.232fb5d8.js"><link rel="prefetch" href="/assets/js/33.0cccd269.js"><link rel="prefetch" href="/assets/js/34.a0a28ba0.js"><link rel="prefetch" href="/assets/js/35.1bed48e7.js"><link rel="prefetch" href="/assets/js/36.657e9ed9.js"><link rel="prefetch" href="/assets/js/37.d7396fd8.js"><link rel="prefetch" href="/assets/js/38.546e30bd.js"><link rel="prefetch" href="/assets/js/39.5161de92.js"><link rel="prefetch" href="/assets/js/4.a7f1d7d0.js"><link rel="prefetch" href="/assets/js/40.8746ffe1.js"><link rel="prefetch" href="/assets/js/41.727bd2e4.js"><link rel="prefetch" href="/assets/js/42.a6842aa4.js"><link rel="prefetch" href="/assets/js/43.63922ae0.js"><link rel="prefetch" href="/assets/js/44.4dbf33d8.js"><link rel="prefetch" href="/assets/js/45.e41db646.js"><link rel="prefetch" href="/assets/js/46.aea9c258.js"><link rel="prefetch" href="/assets/js/47.5fb34d10.js"><link rel="prefetch" href="/assets/js/48.ee4d87b6.js"><link rel="prefetch" href="/assets/js/49.eb75d2a2.js"><link rel="prefetch" href="/assets/js/5.ded03f0e.js"><link rel="prefetch" href="/assets/js/50.fa7c9915.js"><link rel="prefetch" href="/assets/js/51.faeaa9ef.js"><link rel="prefetch" href="/assets/js/52.ca0d908d.js"><link rel="prefetch" href="/assets/js/53.40861c35.js"><link rel="prefetch" href="/assets/js/54.e3070773.js"><link rel="prefetch" href="/assets/js/55.6e118ff2.js"><link rel="prefetch" href="/assets/js/56.228e2516.js"><link rel="prefetch" href="/assets/js/57.62afdd52.js"><link rel="prefetch" href="/assets/js/58.2c05b707.js"><link rel="prefetch" href="/assets/js/59.62b309b1.js"><link rel="prefetch" href="/assets/js/6.3a95fe11.js"><link rel="prefetch" href="/assets/js/60.56920d47.js"><link rel="prefetch" href="/assets/js/61.f86b7f1b.js"><link rel="prefetch" href="/assets/js/62.dded81a0.js"><link rel="prefetch" href="/assets/js/63.cc38fdcb.js"><link rel="prefetch" href="/assets/js/64.f5b8c786.js"><link rel="prefetch" href="/assets/js/65.1e43ef82.js"><link rel="prefetch" href="/assets/js/66.fb5dd36f.js"><link rel="prefetch" href="/assets/js/67.60884eba.js"><link rel="prefetch" href="/assets/js/68.bc2da17f.js"><link rel="prefetch" href="/assets/js/69.1d9805e3.js"><link rel="prefetch" href="/assets/js/7.76d5901e.js"><link rel="prefetch" href="/assets/js/70.f828fed2.js"><link rel="prefetch" href="/assets/js/71.b09738b4.js"><link rel="prefetch" href="/assets/js/72.2478946d.js"><link rel="prefetch" href="/assets/js/73.504a9b13.js"><link rel="prefetch" href="/assets/js/74.1ae315f2.js"><link rel="prefetch" href="/assets/js/75.d3d32fc7.js"><link rel="prefetch" href="/assets/js/76.0898b539.js"><link rel="prefetch" href="/assets/js/77.c0473655.js"><link rel="prefetch" href="/assets/js/78.6817762a.js"><link rel="prefetch" href="/assets/js/79.80873e8a.js"><link rel="prefetch" href="/assets/js/80.1bfba839.js"><link rel="prefetch" href="/assets/js/81.95085c58.js"><link rel="prefetch" href="/assets/js/82.718d994d.js"><link rel="prefetch" href="/assets/js/83.38cbea8f.js"><link rel="prefetch" href="/assets/js/84.4aed0151.js"><link rel="prefetch" href="/assets/js/85.b4b58ffb.js"><link rel="prefetch" href="/assets/js/86.6ce29b31.js"><link rel="prefetch" href="/assets/js/87.ec892f26.js"><link rel="prefetch" href="/assets/js/88.c787c583.js"><link rel="prefetch" href="/assets/js/89.204d6807.js"><link rel="prefetch" href="/assets/js/91.cab4bcd9.js"><link rel="prefetch" href="/assets/js/92.3b7e0952.js"><link rel="prefetch" href="/assets/js/93.238eebb9.js"><link rel="prefetch" href="/assets/js/94.d8c325f8.js"><link rel="prefetch" href="/assets/js/95.3b3dd734.js"><link rel="prefetch" href="/assets/js/96.b8be881c.js"><link rel="prefetch" href="/assets/js/97.f8f5f53a.js"><link rel="prefetch" href="/assets/js/98.343b4e81.js"><link rel="prefetch" href="/assets/js/99.6b42021b.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.19a8d69a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.96eb8417.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端源码解读</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue2相关" class="dropdown-title"><span class="title">Vue2相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue2相关" class="mobile-dropdown-title"><span class="title">Vue2相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueRouter3/" class="nav-link router-link-active">
  Vue Route V3
</a></li><li class="dropdown-item"><!----> <a href="/vuex3/" class="nav-link">
  VueX V3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3相关" class="dropdown-title"><span class="title">Vue3相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue3相关" class="mobile-dropdown-title"><span class="title">Vue3相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CrayonPig/originCodeCommit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue2相关" class="dropdown-title"><span class="title">Vue2相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue2相关" class="mobile-dropdown-title"><span class="title">Vue2相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/vueRouter3/" class="nav-link router-link-active">
  Vue Route V3
</a></li><li class="dropdown-item"><!----> <a href="/vuex3/" class="nav-link">
  VueX V3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue3相关" class="dropdown-title"><span class="title">Vue3相关</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue3相关" class="mobile-dropdown-title"><span class="title">Vue3相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/CrayonPig/originCodeCommit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vueRouter3/" aria-current="page" class="sidebar-link">Vue Router V3 源码解析</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>准备工作</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/prepare/directory.html" class="sidebar-link">目录结构</a></li><li><a href="/vueRouter3/prepare/build.html" class="sidebar-link">源码构建</a></li><li><a href="/vueRouter3/prepare/entry.html" class="sidebar-link">源码入口</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>初始化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/init/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/vueRouter3/init/install.html" class="sidebar-link">注册插件</a></li><li><a href="/vueRouter3/init/instantiate.html" class="sidebar-link">实例化</a></li><li><a href="/vueRouter3/init/mount.html" class="sidebar-link">挂载</a></li><li><a href="/vueRouter3/init/addComponent.html" aria-current="page" class="active sidebar-link">使用组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vueRouter3/init/addComponent.html#init" class="sidebar-link">init</a></li><li class="sidebar-sub-header"><a href="/vueRouter3/init/addComponent.html#registerinstance" class="sidebar-link">registerInstance</a></li></ul></li><li><a href="/vueRouter3/init/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>路由匹配</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/matcher/" class="sidebar-link">路由介绍</a></li><li><a href="/vueRouter3/matcher/matcher.html" class="sidebar-link">匹配器</a></li><li><a href="/vueRouter3/matcher/summary.html" class="sidebar-link">总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>路由模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/mode/" class="sidebar-link">简介</a></li><li><a href="/vueRouter3/mode/history.html" class="sidebar-link">History模式</a></li><li><a href="/vueRouter3/mode/hash.html" class="sidebar-link">Hash模式</a></li><li><a href="/vueRouter3/mode/abstract.html" class="sidebar-link">Abstract模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vueRouter3/advanced/navigation-guards.html" class="sidebar-link">导航守卫</a></li><li><a href="/vueRouter3/advanced/route-view.html" class="sidebar-link">&lt;router-view&gt;</a></li><li><a href="/vueRouter3/advanced/route-link.html" class="sidebar-link">&lt;router-link&gt;</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用组件"><a href="#使用组件" class="header-anchor">#</a> 使用组件</h1> <p>当插件注册完毕，实例初始化完毕，也把实例挂载到<code>Vue</code>实例上后，如何让路由生效呢？这就来到最后一步，使用组件</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647226099-67118">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="&lt;div id=&quot;app&quot;&gt;
  &lt;router-view /&gt;
&lt;/div&gt;
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647226099-67118" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在根组件中使用<code>&lt;router-view /&gt;</code>，用于切换路由</p> <p>本小节不讲<code>&lt;router-view /&gt;</code>的具体实现，具体实现我们后续专门讲解。这里只探讨，当我们使用了这个组件，完成整个初始化的调用后会发生什么事情。</p> <p>当进入根组件时，会触发<code>Vue Router</code>在<code>install</code>函数调用的<code>Vue.mixin</code>方法，并根据根组件生命周期触发对应的方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">beforeCreate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断组件是否存在 router 对象，该对象只在根组件上有</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 设置根组件</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token comment">// 设置vue router实例</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router
      <span class="token comment">// 调用初始化方法</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token comment">// 将当前路由的状态作为组件实例的响应式属性，这样在路由切换时，组件会自动更新</span>
      Vue<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'_route'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 非根组件则直接从父组件中获取</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>_routerRoot<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 当前组件实例注册到父组件中</span>
    <span class="token function">registerInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将当前组件从父组件中注销</span>
    <span class="token function">registerInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647226099-94175">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="Vue.mixin({
  beforeCreate () {
    // 判断组件是否存在 router 对象，该对象只在根组件上有
    if (isDef(this.$options.router)) {
      // 设置根组件
      this._routerRoot = this
      // 设置vue router实例
      this._router = this.$options.router
      // 调用初始化方法
      this._router.init(this)
      // 将当前路由的状态作为组件实例的响应式属性，这样在路由切换时，组件会自动更新
      Vue.util.defineReactive(this, '_route', this._router.history.current)
    } else {
      // 非根组件则直接从父组件中获取
      this._routerRoot = (this.$parent &amp;&amp; this.$parent._routerRoot) || this
    }
    // 当前组件实例注册到父组件中
    registerInstance(this, this)
  },
  destroyed () {
    // 将当前组件从父组件中注销
    registerInstance(this)
  }
})
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647226099-94175" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>当根组件触发<code>beforeCreate</code>钩子函数时，<code>Vue Router</code>做了如下事情</p> <ol><li>判断<code>this.$options.router</code>是否存在，如果存在就是根组件，这里判断依据是<code>new Vue</code>时有初始化参数<code>router</code></li> <li>如果是根组件
<ol><li>保存根组件实例</li> <li>将<code>VueRouter</code>实例挂载到当前实例上</li> <li>调用<code>VueRouter</code>实例的<code>init</code>方法完成初始化</li> <li>将当前路由的状态作为组件实例的响应式属性，这样在路由切换时，组件会自动更新</li></ol></li> <li>如果不是根组件，则从父组件中获取，父组件在初始化的时候会从它的父组件获取，直到根组件为止</li> <li>调用<code>registerInstance</code>方法将当前组件实例注册到父组件中</li></ol> <p>当根组件触发<code>destroyed</code>钩子函数时，<code>Vue Router</code>做了如下事情</p> <ol><li>用<code>registerInstance</code>方法将当前组件从父组件中注销</li></ol> <p>好了，那情况很明显了，我们只需要弄明白<code>init</code>和<code>registerInstance</code>两个方法就可以完成初始化的流程了。</p> <h2 id="init"><a href="#init" class="header-anchor">#</a> init</h2> <p>我们首先梳理<code>init</code>方法是在哪里定义的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 设置vue router实例</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router
<span class="token comment">// 调用初始化方法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647226100-84561">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="// 设置vue router实例
this._router = this.$options.router
// 调用初始化方法
this._router.init(this)
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647226100-84561" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>很明显，<code>init</code>方法就是<code>Vue Router</code>实例上的方法，那源码就很容易找到，在<code>src/router.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">init</span> <span class="token punctuation">(</span>app<span class="token operator">:</span> any <span class="token comment">/* Vue component instance */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// 将当前实例app存到实例列表中</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>apps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

  <span class="token comment">// 增加 vue 的 destroyed 钩子函数</span>
  app<span class="token punctuation">.</span><span class="token function">$once</span><span class="token punctuation">(</span><span class="token string">'hook:destroyed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 查找实例列表中是否存在此实例</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>apps<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
    <span class="token comment">// 如果当前实例被记录到了 this.$router.apps 中, 就将其移除</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>apps<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果 this.app === app 表明在删除最后一个 vue 实例</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">===</span> app<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>apps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">null</span>
    <span class="token comment">// 如果 this.app 为 null，则表示所有 vue 实例都已经被销毁。所以需要销毁 history</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">teardown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 如果 this.app 有值，则直接返回。则 this.app 代表记录根 vue 实例</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果 this.app 不存在，则指向 app 实例</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> app
  <span class="token comment">// 获取 this.$router mode 对应的 history 对象</span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history
  <span class="token comment">// 如果是浏览器的 history 或 hash 模式</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>history <span class="token keyword">instanceof</span> <span class="token class-name">HTML5History</span> <span class="token operator">||</span> history <span class="token keyword">instanceof</span> <span class="token class-name">HashHistory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 操作初始化滚动 </span>
    <span class="token comment">// routeOrError 表示要跳转的 route</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleInitialScroll</span> <span class="token operator">=</span> <span class="token parameter">routeOrError</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 表示即将要跳出的 route</span>
      <span class="token keyword">const</span> from <span class="token operator">=</span> history<span class="token punctuation">.</span>current
      <span class="token comment">// 期望滚动的函数</span>
      <span class="token keyword">const</span> expectScroll <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>scrollBehavior
      <span class="token comment">// 如果mode=history，且当前浏览器支持 h5 history， 则表示支持期望滚动函数</span>
      <span class="token keyword">const</span> supportsScroll <span class="token operator">=</span> supportsPushState <span class="token operator">&amp;&amp;</span> expectScroll
      <span class="token comment">// routeOrError 存在 fullPath 属性， 且 supportsScroll 函数存在</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>supportsScroll <span class="token operator">&amp;&amp;</span> <span class="token string">'fullPath'</span> <span class="token keyword">in</span> routeOrError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> routeOrError<span class="token punctuation">,</span> from<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 如果跳转成功，则传递的参数为 route</span>
    <span class="token comment">// 如果跳转失败，则传递的参数为 error</span>
    <span class="token keyword">const</span> <span class="token function-variable function">setupListeners</span> <span class="token operator">=</span> <span class="token parameter">routeOrError</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      history<span class="token punctuation">.</span><span class="token function">setupListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">handleInitialScroll</span><span class="token punctuation">(</span>routeOrError<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 此次的跳转是针对浏览器地址栏上的 url 进行跳转。
     * 地址栏可能是根路径: http://localhost:8080/；也可能是某个网页的路径 http://localhost:8080/user/info;
     */</span>
    history<span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>
      <span class="token comment">// 获取浏览器地址栏上的 url。</span>
      <span class="token comment">// history.getCurrentLocation()： 返回的是访问地址字符串</span>
      history<span class="token punctuation">.</span><span class="token function">getCurrentLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 路径跳转成功的回调</span>
      setupListeners<span class="token punctuation">,</span>
      <span class="token comment">// 路径跳转失败的回调</span>
      setupListeners
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 在路由变化时，将新的路由对象同步到所有 Vue 实例中，从而触发 Vue 的重新渲染，展示新的页面内容</span>
  history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>apps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span>_route <span class="token operator">=</span> route
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647226100-56513">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="init (app: any /* Vue component instance */) {

  // 将当前实例app存到实例列表中
  this.apps.push(app)

  // 增加 vue 的 destroyed 钩子函数
  app.$once('hook:destroyed', () =&gt; {
    // 查找实例列表中是否存在此实例
    const index = this.apps.indexOf(app)
    // 如果当前实例被记录到了 this.$router.apps 中, 就将其移除
    if (index &gt; -1) this.apps.splice(index, 1)
    // 如果 this.app === app 表明在删除最后一个 vue 实例
    if (this.app === app) this.app = this.apps[0] || null
    // 如果 this.app 为 null，则表示所有 vue 实例都已经被销毁。所以需要销毁 history
    if (!this.app) this.history.teardown()
  })

  // 如果 this.app 有值，则直接返回。则 this.app 代表记录根 vue 实例
  if (this.app) {
    return
  }
  // 如果 this.app 不存在，则指向 app 实例
  this.app = app
  // 获取 this.$router mode 对应的 history 对象
  const history = this.history
  // 如果是浏览器的 history 或 hash 模式
  if (history instanceof HTML5History || history instanceof HashHistory) {
    // 操作初始化滚动 
    // routeOrError 表示要跳转的 route
    const handleInitialScroll = routeOrError =&gt; {
      // 表示即将要跳出的 route
      const from = history.current
      // 期望滚动的函数
      const expectScroll = this.options.scrollBehavior
      // 如果mode=history，且当前浏览器支持 h5 history， 则表示支持期望滚动函数
      const supportsScroll = supportsPushState &amp;&amp; expectScroll
      // routeOrError 存在 fullPath 属性， 且 supportsScroll 函数存在
      if (supportsScroll &amp;&amp; 'fullPath' in routeOrError) {
        handleScroll(this, routeOrError, from, false)
      }
    }
    // 如果跳转成功，则传递的参数为 route
    // 如果跳转失败，则传递的参数为 error
    const setupListeners = routeOrError =&gt; {
      history.setupListeners()
      handleInitialScroll(routeOrError)
    }
    /**
     * 此次的跳转是针对浏览器地址栏上的 url 进行跳转。
     * 地址栏可能是根路径: http://localhost:8080/；也可能是某个网页的路径 http://localhost:8080/user/info;
     */
    history.transitionTo(
      // 获取浏览器地址栏上的 url。
      // history.getCurrentLocation()： 返回的是访问地址字符串
      history.getCurrentLocation(),
      // 路径跳转成功的回调
      setupListeners,
      // 路径跳转失败的回调
      setupListeners
    )
  }

  // 在路由变化时，将新的路由对象同步到所有 Vue 实例中，从而触发 Vue 的重新渲染，展示新的页面内容
  history.listen(route =&gt; {
    this.apps.forEach(app =&gt; {
      app._route = route
    })
  })
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647226100-56513" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p><code>init</code>方法的逻辑不复杂，主要做了以下几件事</p> <ol><li>将当前实例存到实例列表中</li> <li>增加 <code>vue</code> 的 <code>destroyed</code> 钩子函数，当实例被销毁时，从实例列表中删除此实例，如果删除完后实例列表中为空，代表根组件也被销毁了，则销毁<code>history</code></li> <li>定义<code>this.app</code>只记录一次，使之永远是根组件的实例</li> <li>如果是浏览器的 <code>history</code> 或 <code>hash</code> 模式，则初始化滚动相关方法，这个我们后续单独讲</li> <li>最后监听路由变化，当路由变化时，将新的路由对象同步到所有 Vue 实例中，从而触发 Vue 的重新渲染，展示新的页面内容</li></ol> <h2 id="registerinstance"><a href="#registerinstance" class="header-anchor">#</a> registerInstance</h2> <p>搞清楚<code>init</code>逻辑后，我们来看<code>registerInstance</code>方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 将子组件实例注册到父组件实例
 * @param {*} vm  Vue 组件实例，即要注册的子组件实例
 * @param {*} callVal 可选参数，用于在注册时传递额外的数据
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">registerInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> callVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_parentVnode
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token comment">// 父组件的 VNode 是否存在</span>
    <span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
    <span class="token comment">// 父组件 VNode 的 data 属性是否存在</span>
    <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
    <span class="token comment">// data 属性中是否定义了 registerRouteInstance 方法</span>
    <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>registerRouteInstance<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用registerRouteInstance注册</span>
    <span class="token function">i</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> callVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647226101-84162">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="/**
 * 将子组件实例注册到父组件实例
 * @param {*} vm  Vue 组件实例，即要注册的子组件实例
 * @param {*} callVal 可选参数，用于在注册时传递额外的数据
 */
const registerInstance = (vm, callVal) =&gt; {
  let i = vm.$options._parentVnode
  if (
    // 父组件的 VNode 是否存在
    isDef(i) &amp;&amp; 
    // 父组件 VNode 的 data 属性是否存在
    isDef(i = i.data) &amp;&amp; 
    // data 属性中是否定义了 registerRouteInstance 方法
    isDef(i = i.registerRouteInstance)
  ) {
    // 调用registerRouteInstance注册
    i(vm, callVal)
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647226101-84162" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这么看可能有点乱，我们把代码转换下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">registerInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> callVal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_parentVnode
  <span class="token comment">// 父组件的 VNode 是否存在</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> i<span class="token punctuation">.</span>data 
    <span class="token comment">// 父组件 VNode 的 data 属性是否存在</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> registerRouteInstance <span class="token operator">=</span> data<span class="token punctuation">.</span>registerRouteInstance
      <span class="token comment">// data 属性中是否定义了 registerRouteInstance 方法</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>registerRouteInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">registerRouteInstance</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> callVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="m-mdic-copy-wrapper"><div class="u-mdic-copy-notify" id="j-notify-1731647226101-10197">成功</div><button class="u-mdic-copy-btn j-mdic-copy-btn" data-mdic-content="const registerInstance = (vm, callVal) =&gt; {
  let i = vm.$options._parentVnode
  // 父组件的 VNode 是否存在
  if (isDef(i)) {
    const data = i.data 
    // 父组件 VNode 的 data 属性是否存在
    if(isDef(data)) {
      const registerRouteInstance = data.registerRouteInstance
      // data 属性中是否定义了 registerRouteInstance 方法
      if(isDef(registerRouteInstance)) {
        registerRouteInstance(vm, callVal)
      }
    }
  }
}
" data-mdic-attach-content="" data-mdic-notify-id="j-notify-1731647226101-10197" data-mdic-notify-delay="2000" data-mdic-copy-fail-text="copy fail" onclick="!function(t){const e={copy:(t='',e='')=&gt;new Promise((c,o)=&gt;{const n=document.createElement('textarea'),d=e?`\n\n${e}`:e;n.value=`${t}${d}`,document.body.appendChild(n),n.select();try{const t=document.execCommand('copy');document.body.removeChild(n),t?c():o()}catch(t){document.body.removeChild(n),o()}}),btnClick(t){const c=t&amp;&amp;t.dataset?t.dataset:{},o=c.mdicNotifyId,n=document.getElementById(o),d=c.mdicNotifyDelay,i=c.mdicCopyFailText;e.copy(c.mdicContent,c.mdicAttachContent).then(()=&gt;{n.style.display='block',setTimeout(()=&gt;{n.style.display='none'},d)}).catch(()=&gt;{alert(i)})}};e.btnClick(t)}(this);">复制代码</button></div></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这样就很明显了，<code>registerInstance</code> 最终就是调用的<code>vm.$options._parentVnode.data.registerRouteInstance</code>。那这个方法是哪来的呢？这个方法是在<code>router-view</code>组件中被定义的，我们后续讲，这里只需要知道，这是完成了对<code>router-view</code>的挂载操作</p> <p>所以知道为什么说，当我们使用了<code>router-view</code>组件，才能完成整个初始化的调用了吧。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vueRouter3/init/mount.html" class="prev">
        挂载
      </a></span> <span class="next"><a href="/vueRouter3/init/summary.html">
        总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bd142e4f.js" defer></script><script src="/assets/js/2.ff6775b1.js" defer></script><script src="/assets/js/1.1085e0bf.js" defer></script><script src="/assets/js/90.10eca24a.js" defer></script>
  </body>
</html>
